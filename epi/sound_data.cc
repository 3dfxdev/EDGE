//----------------------------------------------------------------------------
//  Sound Data
//----------------------------------------------------------------------------
//
//  Copyright (c) 1999-2008  The EDGE Team.
//
//  This program is free software; you can redistribute it and/or
//  modify it under the terms of the GNU General Public License
//  as published by the Free Software Foundation; either version 2
//  of the License, or (at your option) any later version.
//
//  This program is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//  GNU General Public License for more details.
//
//----------------------------------------------------------------------------

#include "epi.h"
#include "sound_data.h"

#include <vector>

namespace epi
{
	sound_data_c::sound_data_c() :
		length(0), freq(0), mode(0),
		data_L(NULL), data_R(NULL),
		priv_data(NULL), ref_count(0)
	{ }

	sound_data_c::~sound_data_c()
	{
		Free();
	}

	void sound_data_c::Free()
	{
		length = 0;

		if (data_R && data_R != data_L)
			delete[] data_R;

		if (data_L)
			delete[] data_L;

		data_L = NULL;
		data_R = NULL;
	}

	void sound_data_c::Allocate(int samples, int buf_mode)
	{
		// early out when requirements are already met
		if (data_L && length >= samples && mode == buf_mode)
		{
			length = samples;  // FIXME: perhaps keep allocated count
			return;
		}

		if (data_L || data_R)
		{
			Free();
		}

		length = samples;
		mode = buf_mode;

		switch (buf_mode)
		{
		case SBUF_Mono:
			data_L = new s16_t[samples];
			data_R = data_L;
			break;

		case SBUF_Stereo:
			data_L = new s16_t[samples];
			data_R = new s16_t[samples];
			break;

		case SBUF_Interleaved:
			data_L = new s16_t[samples * 2];
			data_R = data_L;
			break;

		default: break;
		}
	}
}  // namespace epi

//--- editor settings ---
// vi:ts=4:sw=4:noexpandtab